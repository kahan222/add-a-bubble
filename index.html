<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add a Bubble - AR ì¹´ë©”ë¼</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: black; }
    #camera-view { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: -1; }
    #btn-download, #btn-upload, #btn-share {
      position: absolute; bottom: 100px;
      background: white; padding: 8px 12px; border-radius: 8px; font-size: 14px; border: none;
      z-index: 10; cursor: pointer;
    }
    #btn-download { left: 20px; }
    #btn-upload { left: 140px; }
    #btn-share { left: 260px; }
    button:disabled { opacity: 0.4; cursor: not-allowed; }
  </style>
</head>
<body>
  <video id="camera-view" autoplay playsinline muted></video>
  <button id="btn-download" disabled>ğŸ“¥ ì €ì¥</button>
  <button id="btn-upload" disabled>â˜ï¸ ì—…ë¡œë“œ</button>
  <button id="btn-share" disabled>ğŸ“¤ ê³µìœ </button>

  <script>
    let lastCaptureBlob = null;
    const video = document.getElementById("camera-view");

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(stream => video.srcObject = stream)
      .catch(err => console.error("ì¹´ë©”ë¼ ì˜¤ë¥˜:", err));

    // ê°€ìƒ ìº¡ì²˜ ì‹œë®¬ë ˆì´ì…˜ (ì„ì‹œ)
    setTimeout(() => {
      const canvas = document.createElement("canvas");
      canvas.width = 640; canvas.height = 480;
      const ctx = canvas.getContext("2d");
      ctx.fillStyle = "black"; ctx.fillRect(0, 0, 640, 480);
      ctx.fillStyle = "white"; ctx.font = "24px sans-serif";
      ctx.fillText("ìº¡ì²˜ëœ ì´ë¯¸ì§€ì…ë‹ˆë‹¤", 160, 240);
      canvas.toBlob(blob => {
        lastCaptureBlob = blob;
        document.getElementById('btn-download').disabled = false;
        document.getElementById('btn-upload').disabled = false;
        document.getElementById('btn-share').disabled = false;
      }, 'image/png');
    }, 2000);

    document.getElementById('btn-download').addEventListener('click', () => {
      const url = URL.createObjectURL(lastCaptureBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'capture.png';
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    document.getElementById('btn-upload').addEventListener('click', () => {
      alert("Firebase ì—…ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ (ì—¬ê¸°ì— ì—°ê²°)");
    });

    document.getElementById('btn-share').addEventListener('click', async () => {
      const file = new File([lastCaptureBlob], 'capture.png', { type: 'image/png' });
      const shareData = { title: 'Add a Bubble', files: [file] };
      if (navigator.canShare && navigator.canShare(shareData)) {
        try {
          await navigator.share(shareData);
          alert("ê³µìœ  ì™„ë£Œ!");
        } catch (err) { console.error(err); }
      } else {
        alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    });
  </script>
</body>
</html>
