<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text Bubble Capture</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      overflow: hidden;
      font-family: sans-serif;
      background: black;
    }
    #camera-view {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: -1;
    }
    .text-carousel {
      position: absolute;
      bottom: 0;
      width: 100vw;
      height: 80px;
      display: flex;
      overflow-x: auto;
      background: rgba(0,0,0,0.4);
      padding: 6px;
      z-index: 10;
    }
    .text-option {
      background: white;
      color: black;
      border-radius: 12px;
      padding: 4px 10px;
      margin: 0 6px;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    .text-option.selected {
      border: 2px solid black;
      background: #f0f0f0;
    }
    .name-en { font-weight: bold; }
    .name-ko { font-size: 12px; color: #555; }
    #bubble-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 14px 20px;
      border-radius: 20px;
      color: white;
      font-size: 18px;
      font-weight: bold;
      max-width: 80vw;
      text-align: center;
      z-index: 5;
      pointer-events: auto;
      cursor: grab;
      user-select: none;
      text-shadow: 1px 1px 2px black;
      display: none;
      word-break: break-word;
    }
    .bubble-style-2 {
      background: white !important;
      color: black !important;
      text-shadow: none !important;
    }
    .quote-en, .quote-ko { margin: 4px 0; }
    #toggle-lang, #capture, #share, #style-toggle {
      position: absolute;
      z-index: 10;
      background: white;
      border: none;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }
    #toggle-lang { bottom: 130px; left: 20px; font-weight: bold; }
    #capture {
      bottom: 130px; right: 20px;
      width: 60px; height: 60px;
      font-size: 26px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #style-toggle { bottom: 200px; right: 20px; }
    #share { bottom: 200px; left: 20px; }
  </style>
</head>
<body>
  <video id="camera-view" autoplay playsinline muted></video>

  <div class="text-carousel">
    <div class="text-option" data-id="JohnCage"><div class="name-en">John Cage</div><div class="name-ko">ì¡´ ì¼€ì´ì§€</div></div>
    <div class="text-option" data-id="AndyWarhol"><div class="name-en">Andy Warhol</div><div class="name-ko">ì•¤ë”” ì›Œí™€</div></div>
    <div class="text-option" data-id="Joseph"><div class="name-en">Joseph Beuys</div><div class="name-ko">ìš”ì…‰ ë³´ì´ìŠ¤</div></div>
    <div class="text-option" data-id="DamienHirst"><div class="name-en">Damien Hirst</div><div class="name-ko">ë°ë¯¸ì•ˆ í—ˆìŠ¤íŠ¸</div></div>
    <div class="text-option" data-id="Paik"><div class="name-en">Nam June Paik</div><div class="name-ko">ë°±ë‚¨ì¤€</div></div>
    <div class="text-option" data-id="Marcel"><div class="name-en">Marcel Duchamp</div><div class="name-ko">ë§ˆë¥´ì…€ ë’¤ìƒ¹</div></div>
    <div class="text-option" data-id="AbramoviÄ‡"><div class="name-en">Marina AbramoviÄ‡</div><div class="name-ko">ë§ˆë¦¬ë‚˜ ì•„ë¸Œë¼ëª¨ë¹„ì¹˜</div></div>
    <div class="text-option" data-id="Donald"><div class="name-en">Donald Judd</div><div class="name-ko">ë„ë„ë“œ ì €ë“œ</div></div>
    <div class="text-option" data-id="Nauman"><div class="name-en">Bruce Nauman</div><div class="name-ko">ë¸Œë£¨ìŠ¤ ë‚˜ìš°ë¨¼</div></div>
    <div class="text-option" data-id="Paul"><div class="name-en">Paul McCarthy</div><div class="name-ko">í´ ë§¤ì¹´ì‹œ</div></div>
  </div>

  <div id="bubble-text">
    <div class="quote-en"></div>
    <div class="quote-ko"></div>
  </div>

  <button id="toggle-lang">KO / EN</button>
  <button id="capture">ğŸ“¸</button>
  <button id="style-toggle">Style</button>
  <button id="share">Share</button>

  <script>
    const video = document.getElementById('camera-view');
    const bubble = document.getElementById('bubble-text');
    const quoteEn = document.querySelector('.quote-en');
    const quoteKo = document.querySelector('.quote-ko');
    const quotes = {
      JohnCage: {
        en: "I can't understand why people are frightened of new ideas. I'm frightened of the old ones.",
        ko: "ì‚¬ëŒë“¤ì´ ì™œ ìƒˆë¡œìš´ ìƒê°ì„ ë‘ë ¤ì›Œí•˜ëŠ”ì§€ ì´í•´í•  ìˆ˜ ì—†ë‹¤. ë‚˜ëŠ” ì˜¤ë˜ëœ ìƒê°ì´ ë‘ë µë‹¤."
      },
      AndyWarhol: {
        en: "An artist is somebody who produces things that people don't need to have.",
        ko: "ì˜ˆìˆ ê°€ëŠ” ì‚¬ëŒë“¤ì´ ê°€ì§ˆ í•„ìš”ê°€ ì—†ëŠ” ê²ƒë“¤ì„ ìƒì‚°í•˜ëŠ” ì‚¬ëŒì´ë‹¤."
      },
      Joseph: {
        en: "Art alone makes life possible.",
        ko: "ì˜ˆìˆ ì€ ì‚¶ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ìœ ì¼í•œ ê²ƒì´ë‹¤."
      },
      DamienHirst: {
        en: "Good art is when you look at it, experience it, and it stays in your mind.",
        ko: "ì¢‹ì€ ì˜ˆìˆ ì´ë€ ê·¸ê²ƒì„ ë³´ê³  ê²½í—˜í•œ í›„ì—ë„ ê³„ì†í•´ì„œ ë§ˆìŒì†ì— ë‚¨ì•„ ìˆëŠ” ê²ƒì´ë‹¤."
      },
      Paik: {
        en: "I make technology ridiculous.",
        ko: "ë‚˜ëŠ” ê¸°ìˆ ì„ ìš°ìŠ¤ê½ìŠ¤ëŸ½ê²Œ ë§Œë“ ë‹¤."
      },
      Marcel: {
        en: "The artist performs only one part of the creative process. The onlooker completes it.",
        ko: "ì˜ˆìˆ ê°€ëŠ” ì°½ì‘ ê³¼ì •ì˜ ì¼ë¶€ë§Œì„ ìˆ˜í–‰í•œë‹¤. ë³´ëŠ” ì‚¬ëŒì´ ê·¸ê²ƒì„ ì™„ì„±í•œë‹¤."
      },
      AbramoviÄ‡: {
        en: "I came to believe that art must be disturbing.",
        ko: "ë‚˜ëŠ” ì˜ˆìˆ ì´ ë¶ˆí¸í•´ì•¼ í•œë‹¤ê³  ë¯¿ê²Œ ë˜ì—ˆë‹¤."
      },
      Donald: {
        en: "Art is free, but it is not a free-for-all.",
        ko: "ì˜ˆìˆ ì€ ììœ ë¡­ì§€ë§Œ, ë¬´ì§ˆì„œí•œ ììœ ëŠ” ì•„ë‹ˆë‹¤."
      },
      Nauman: {
        en: "The true artist helps the world by revealing mystic truths.",
        ko: "ì§„ì •í•œ ì˜ˆìˆ ê°€ëŠ” ì‹ ë¹„í•œ ì§„ì‹¤ì„ ë“œëŸ¬ëƒ„ìœ¼ë¡œì¨ ì„¸ìƒì„ ë•ëŠ”ë‹¤."
      },
      Paul: {
        en: "My work refers to my private, forgotten or repressed memories.",
        ko: "ë‚´ ì‘ì—…ì€ ë‚´ ê°œì¸ì ì¸, ìŠí˜€ì¡Œê±°ë‚˜ ì–µì••ëœ ê¸°ì–µê³¼ ê´€ë ¨ì´ ìˆë‹¤."
      }
    };

    let currentLang = 'en';
    function updateQuote(id, optionEl) {
      const quote = quotes[id];
      if (!quote) return;
      quoteEn.textContent = quote.en;
      quoteKo.textContent = quote.ko;
      bubble.style.display = 'block';
      bubble.style.left = '50%';
      bubble.style.top = '50%';
      bubble.style.transform = 'translate(-50%, -50%)';
      updateLangVisibility();
      document.querySelectorAll('.text-option').forEach(el => el.classList.remove('selected'));
      optionEl.classList.add('selected');
    }
    function updateLangVisibility() {
      quoteEn.style.display = (currentLang === 'en') ? 'block' : 'none';
      quoteKo.style.display = (currentLang === 'ko') ? 'block' : 'none';
    }
    document.querySelectorAll('.text-option').forEach(option => {
      option.addEventListener('click', () => updateQuote(option.dataset.id, option));
    });
    document.getElementById('toggle-lang').addEventListener('click', () => {
      currentLang = (currentLang === 'en') ? 'ko' : 'en';
      updateLangVisibility();
    });

    document.getElementById('style-toggle').addEventListener('click', () => {
      bubble.classList.toggle('bubble-style-2');
    });

    document.getElementById('share').addEventListener('click', () => {
      const text = (currentLang === 'en') ? quoteEn.textContent : quoteKo.textContent;
      const shareData = {
        title: 'Art Quote',
        text: text,
        url: window.location.href
      };
      if (navigator.share) {
        navigator.share(shareData).catch((err) => console.error('Share failed:', err));
      } else {
        alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    });

    let isDragging = false, offsetX, offsetY;
    bubble.addEventListener('mousedown', startDrag);
    bubble.addEventListener('touchstart', startDrag, { passive: false });
    function startDrag(e) {
      isDragging = true;
      const rect = bubble.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      offsetX = clientX - rect.left;
      offsetY = clientY - rect.top;
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);
      document.addEventListener('touchmove', onDrag, { passive: false });
      document.addEventListener('touchend', stopDrag);
    }
    function onDrag(e) {
      if (!isDragging) return;
      e.preventDefault();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      const bubbleWidth = bubble.offsetWidth;
      const bubbleHeight = bubble.offsetHeight;
      const maxX = window.innerWidth - bubbleWidth;
      const maxY = window.innerHeight - bubbleHeight;
      let x = clientX - offsetX;
      let y = clientY - offsetY;
      x = Math.max(0, Math.min(x, maxX));
      y = Math.max(0, Math.min(y, maxY));
      bubble.style.left = `${x}px`;
      bubble.style.top = `${y}px`;
      bubble.style.transform = `translate(0, 0)`;
    }
    function stopDrag() {
      isDragging = false;
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', stopDrag);
      document.removeEventListener('touchmove', onDrag);
      document.removeEventListener('touchend', stopDrag);
    }

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => video.srcObject = stream);

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      for (let i = 0; i < words.length; i++) {
        const testLine = line + words[i] + ' ';
        const testWidth = ctx.measureText(testLine).width;
        if (testWidth > maxWidth && i > 0) {
          ctx.fillText(line, x, y);
          line = words[i] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, y);
    }

    document.getElementById('capture').addEventListener('click', () => {
      const canvas = document.createElement('canvas');
      const width = video.videoWidth;
      const height = video.videoHeight;
      if (!width || !height) {
        alert("ì¹´ë©”ë¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.");
        return;
      }
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, width, height);
      const bubbleRect = bubble.getBoundingClientRect();
      const videoRect = video.getBoundingClientRect();
      const scaleX = width / videoRect.width;
      const scaleY = height / videoRect.height;
      const x = (bubbleRect.left - videoRect.left) * scaleX;
      const y = (bubbleRect.top - videoRect.top) * scaleY;
      const bubbleW = bubbleRect.width * scaleX;
      const bubbleH = bubbleRect.height * scaleY;
      ctx.fillStyle = window.getComputedStyle(bubble).backgroundColor;
      ctx.fillRect(x, y, bubbleW, bubbleH);
      ctx.fillStyle = window.getComputedStyle(bubble).color;
      ctx.font = `${18 * scaleY}px sans-serif`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      const text = (currentLang === 'en') ? quoteEn.textContent : quoteKo.textContent;
      wrapText(ctx, text, x + bubbleW/2, y + bubbleH/2 - 10, bubbleW - 20, 24 * scaleY);
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png');
      link.download = 'text-bubble-capture.png';
      link.click();
    });
  </script>
</body>
</html>
