<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add a Bubble - Final Version</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      overflow: hidden;
      font-family: sans-serif;
      background: black;
    }
    #camera-view {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: -1;
    }
    .text-carousel {
      position: absolute;
      bottom: 0;
      width: 100vw;
      height: 80px;
      display: flex;
      overflow-x: auto;
      background: rgba(0,0,0,0.4);
      padding: 6px;
      z-index: 10;
    }
    .text-option {
      background: white;
      color: black;
      border-radius: 12px;
      padding: 4px 10px;
      margin: 0 6px;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    .text-option.selected {
      background: #f0f0f0;
    }
    .name-en { font-weight: bold; }
    .name-ko { font-size: 12px; color: #555; }

    #bubble-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: transparent;
      padding: 0;
      border-radius: 0;
      color: white;
      font-size: 18px;
      font-weight: bold;
      max-width: 80vw;
      text-align: center;
      z-index: 5;
      pointer-events: auto;
      cursor: grab;
      user-select: none;
      display: none;
      word-break: break-word;
    }

    .quote-en, .quote-ko { margin: 4px 0; }

    button {
      position: absolute;
      z-index: 10;
      background: white;
      border: none;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    #toggle-lang { bottom: 120px; left: 20px; font-weight: bold; }
    #capture { bottom: 120px; left: 50%; transform: translateX(-50%); font-size: 25px; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; }
    #effect { bottom: 120px; right: 20px; }

    .neon-1 { color: white; text-shadow: 0 0 5px #00ff90, 0 0 10px #00ff90, 0 0 20px #00ff90; }
    .neon-2 { color: white; text-shadow: 0 0 5px #ffaa00, 0 0 10px #ffaa00, 0 0 20px #ffaa00; }
    .neon-3 { color: white; text-shadow: 0 0 5px #00ccff, 0 0 10px #00ccff, 0 0 20px #00ccff; }
  </style>
</head>
<body>
  <video id="camera-view" autoplay playsinline muted></video>

  <div class="text-carousel">
    <div class="text-option" data-id="Han1"><div class="name-en">One Sentence</div><div class="name-ko">í•œ ë¬¸ì¥</div></div>
    <div class="text-option" data-id="Han2"><div class="name-en">Try</div><div class="name-ko">ì‹œë„</div></div>
    <div class="text-option" data-id="Han3"><div class="name-en">Life</div><div class="name-ko">ì‚¶</div></div>
    <div class="text-option" data-id="Han4"><div class="name-en">Uniqueness</div><div class="name-ko">ìœ ì¼í•¨</div></div>
    <div class="text-option" data-id="Han5"><div class="name-en">Uncomfortable</div><div class="name-ko">ë¶ˆí¸í•¨</div></div>
    <div class="text-option" data-id="Han6"><div class="name-en">Technology</div><div class="name-ko">ê¸°ìˆ </div></div>
    <div class="text-option" data-id="Han7"><div class="name-en">Imagination</div><div class="name-ko">ìƒìƒë ¥</div></div>
    <div class="text-option" data-id="Han8"><div class="name-en">Incomplete</div><div class="name-ko">ë¯¸ì™„ì„±</div></div>
    <div class="text-option" data-id="Han9"><div class="name-en">Truth</div><div class="name-ko">ì§„ì‹¤</div></div>
    <div class="text-option" data-id="Han10"><div class="name-en">Thief</div><div class="name-ko">ë„ë‘‘</div></div>
  </div>

  <div id="bubble-text"><div class="quote-en"></div><div class="quote-ko"></div></div>
  <button id="toggle-lang">KO / EN</button>
  <button id="capture">ğŸ“¸</button>
  <button id="effect">Effect</button>
  <button id="save-share-btn" style="display:none; position:absolute; bottom: 200px; left: 50%; transform: translateX(-50%); z-index:10; background:white; border:none; border-radius:10px; padding:10px 16px; font-size:14px; font-weight:bold; cursor:pointer;"></button>


  <script>
    const video = document.getElementById('camera-view');
    const bubble = document.getElementById('bubble-text');
    const quoteEn = document.querySelector('.quote-en');
    const quoteKo = document.querySelector('.quote-ko');
    const captureBtn = document.getElementById('capture');
captureBtn.addEventListener('click', () => {
  const canvas = document.createElement('canvas');
  const width = video.videoWidth;
  const height = video.videoHeight;
  canvas.width = width;
  canvas.height = height;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, width, height);

  const bubbleRect = bubble.getBoundingClientRect();
  const scaleX = width / window.innerWidth;
  const scaleY = height / window.innerHeight;
  const x = bubbleRect.left * scaleX + bubbleRect.width * scaleX / 2;
  const y = bubbleRect.top * scaleY + bubbleRect.height * scaleY / 2;

  ctx.font = "bold 30px sans-serif";
  ctx.fillStyle = "white";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.shadowColor = "#00ff90";
  ctx.shadowBlur = 10;
  ctx.fillText(bubble.textContent.trim(), x, y);

  canvas.toBlob(blob => {
    lastCaptureBlob = blob;
    video.style.display = 'none';
    bubble.style.display = 'none';
    captureBtn.style.display = 'none';
    saveShareBtn.style.display = 'block';
  }, 'image/png');
});
    const quotes = {
      Han1: { en: "If it can be expressed in one sentence, is it really art?", ko: "í•œ ë¬¸ì¥ìœ¼ë¡œ í‘œí˜„ì´ ê°€ëŠ¥í•˜ë‹¤ë©´, ê·¸ê²Œ ì˜ˆìˆ ì´ ë§ëŠ”ê°€?" },
      Han2: { en: "If you think you can do it too, maybe you should try.", ko: "ë‚˜ë„ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤ë©´, í•œ ë²ˆ í•´ë³´ëŠ” ê²ƒë„ ì¢‹ì„ë“¯." },
      Han3: { en: "How many people truly equate art with life?", ko: "ì˜ˆìˆ ê³¼ ì‚¶ì„ ë™ì¼ì‹œ í•˜ëŠ” ì‚¬ëŒì´ ëª‡ì´ë‚˜ ë˜ê² ëŠ”ê°€." },
      Han4: { en: "If uniqueness defines art, that idea is already outdated.", ko: "ìœ ì¼í•¨ì´ ì˜ˆìˆ ì˜ íŠ¹ì„±ì´ë€ ë§ì€, ì˜› ë§ì¼ ë¿ì´ë‹¤." },
      Han5: { en: "Uncomfortable to see, impossible to forget.", ko: "ë¶ˆí¸í•´ì„œ ëˆˆì„ í”¼í–ˆì§€ë§Œ, ê³„ì† ìƒê°ë‚˜ë”ë¼." },
      Han6: { en: "The more technology evolves, the more extraordinary the artist becomes.", ko: "ê¸°ìˆ ì´ ë°œì „í• ìˆ˜ë¡ ì˜ˆìˆ ê°€ëŠ” ë” ëŒ€ë‹¨í•´ì§„ë‹¤." },
      Han7: { en: "Perfect order leaves no room for imagination.", ko: "ì™„ë²½í•œ ì§ˆì„œëŠ” ìƒìƒë ¥ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤." },
      Han8: { en: "Without a viewer, it's incomplete.", ko: "ë³´ëŠ” ì´ê°€ ì—†ìœ¼ë©´, ë¯¸ì™„ì„±ì´ë‹¤." },
      Han9: { en: "If all you want is to speak the truth, go to a news studio, not a gallery.", ko: "ì§„ì‹¤ë§Œì„ ë§í•˜ë ¤ë©´, ë¯¸ìˆ ê´€ì´ ì•„ë‹ˆë¼ ë°©ì†¡êµ­ìœ¼ë¡œ ê°€ë¼." },
      Han10: { en: "Some works retrieve forgotten memories like a thief.", ko: "ì–´ë–¤ ì‘í’ˆì€ ìŠê³  ìˆì—ˆë˜ ê¸°ì–µì„ ë„ë‘‘ì²˜ëŸ¼ ì°¾ì•„ë‚¸ë‹¤." }
    };

    let currentLang = 'en';
    let currentStyleIndex = 0;
    const styles = ['neon-1','neon-2','neon-3'];

    function updateLangVisibility() {
      quoteEn.style.display = (currentLang === 'en') ? 'block' : 'none';
      quoteKo.style.display = (currentLang === 'ko') ? 'block' : 'none';
    }

    function updateQuote(id, optionEl) {
      const quote = quotes[id];
      if (!quote) return;
      quoteEn.textContent = quote.en;
      quoteKo.textContent = quote.ko;
      bubble.style.display = 'block';
      bubble.style.left = '50%';
      bubble.style.top = '50%';
      bubble.style.transform = 'translate(-50%, -50%)';
      updateLangVisibility();
      bubble.className = ''; bubble.classList.add(styles[currentStyleIndex]);
      document.querySelectorAll('.text-option').forEach(el => el.classList.remove('selected'));
      optionEl.classList.add('selected');
    }

    document.querySelectorAll('.text-option').forEach(option => {
      option.addEventListener('click', () => updateQuote(option.dataset.id, option));
    });

    document.getElementById('toggle-lang').addEventListener('click', () => {
      currentLang = (currentLang === 'en') ? 'ko' : 'en';
      updateLangVisibility();
    });

    document.getElementById('effect').addEventListener('click', () => {
      bubble.classList.remove(styles[currentStyleIndex]);
      currentStyleIndex = (currentStyleIndex + 1) % styles.length;
      bubble.classList.add(styles[currentStyleIndex]);
    });

    // ë“œë˜ê·¸
    let isDragging = false, offsetX, offsetY;
    bubble.addEventListener('mousedown', startDrag);
    bubble.addEventListener('touchstart', startDrag, { passive: false });

    function startDrag(e) {
      isDragging = true;
      const rect = bubble.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      offsetX = clientX - rect.left;
      offsetY = clientY - rect.top;
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);
      document.addEventListener('touchmove', onDrag, { passive: false });
      document.addEventListener('touchend', stopDrag);
    }

    function onDrag(e) {
      if (!isDragging) return;
      e.preventDefault();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      const bubbleWidth = bubble.offsetWidth;
      const bubbleHeight = bubble.offsetHeight;
      const maxX = window.innerWidth - bubbleWidth;
      const maxY = window.innerHeight - bubbleHeight;
      let x = clientX - offsetX;
      let y = clientY - offsetY;
      x = Math.max(0, Math.min(x, maxX));
      y = Math.max(0, Math.min(y, maxY));
      bubble.style.left = `${x}px`;
      bubble.style.top = `${y}px`;
      bubble.style.transform = 'translate(0, 0)';
    }

    function stopDrag() {
      isDragging = false;
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', stopDrag);
      document.removeEventListener('touchmove', onDrag);
      document.removeEventListener('touchend', stopDrag);
    }

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => video.srcObject = stream)
      .catch(err => {
        console.error("ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨:", err);
        alert("ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.");
      });
saveShareBtn.addEventListener('click', async () => {
  if (!lastCaptureBlob) return;

  // ë‹¤ìš´ë¡œë“œ ì €ì¥
  const url = URL.createObjectURL(lastCaptureBlob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'bubble.png';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);

  // ì—…ë¡œë“œ (ì„ íƒì ìœ¼ë¡œ imgbb + firestore ì—°ë™ ê°€ëŠ¥)
  // await uploadCapturedImage(lastCaptureBlob);

  alert("âœ… ì €ì¥ ë° ê³µìœ ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
  location.reload(); // ì´ˆê¸°í™”
});
    
  </script>
</body>
</html>
