<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Add a Bubble</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      background: black;
    }
    #camera-view {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 0;
    }
    .sticker {
      position: absolute;
      font-size: 24px;
      background: white;
      color: black;
      padding: 4px 10px;
      border-radius: 12px;
      cursor: move;
      white-space: pre-line;
    }
.text-sticker {
  position: absolute;
  font-size: 20px;
  color: white;
  background: none;
  border: none;
  text-align: center;
  white-space: pre-line;
  text-shadow:
    0 0 5px #ffa500,
    0 0 10px #ffa500,
    0 0 20px #ffa500,
    0 0 40px #ffa500;
}
    .sticker-bar, .text-carousel {
      position: absolute;
      width: 100%;
      display: flex;
      overflow-x: auto;
      background: rgba(0,0,0,0.5);
      padding: 6px;
      z-index: 10;
    }
    .sticker-bar {
      bottom: 0;
    }
    .text-carousel {
      bottom: 20px;
    }
    .sticker-option, .text-option {
      background: white;
      color: black;
      padding: 6px 12px;
      border-radius: 20px;
      margin-right: 10px;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      flex-shrink: 0;
    }

     .text-option.selected {
      outline: 3px solid yellow;
      background: #ffffcc;
    }
    .name-en {
      font-weight: bold;
    }
    .name-ko {
      font-size: 12px;
    }
#capture-btn {
  position: absolute;
  bottom: 150px;
  left: 50%;
  transform: translateX(-50%);  
  padding: 12px 24px;
  background: #d60000;        
  color: white;       
  border: none;
  border-radius: 12px;
  font-weight: bold;
  font-size: 16px;
  z-index: 11;
  cursor: pointer;
}
  </style>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

</head>
<body>
  <video id="camera-view" autoplay playsinline muted></video>

<button id="lang-toggle" style="
  position: absolute;
  bottom: 110px;    
  left: 20px;    
  z-index: 12;
  background: white;
  color: black;
  border: none;
  padding: 8px 14px;
  border-radius: 10px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
">Ìïú/EN</button>

  <button id="color-toggle" style="
  position: absolute;
  bottom: 110px;
  right: 20px;
  z-index: 12;
  background: white;
  color: black;
  border: none;
  padding: 8px 14px;
  border-radius: 10px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
">COLOR</button>
  
  <div class="text-carousel" id="text-carousel">
    <div class="text-option" data-id="Han1"><div class="name-en">One Sentence</div><div class="name-ko">Ìïú Î¨∏Ïû•</div></div>
    <div class="text-option" data-id="Han2"><div class="name-en">Try</div><div class="name-ko">ÏãúÎèÑ</div></div>
    <div class="text-option" data-id="Han3"><div class="name-en">Life</div><div class="name-ko">ÏÇ∂</div></div>
    <div class="text-option" data-id="Han4"><div class="name-en">Uniqueness</div><div class="name-ko">Ïú†ÏùºÌï®</div></div>
    <div class="text-option" data-id="Han5"><div class="name-en">Uncomfortable</div><div class="name-ko">Î∂àÌé∏Ìï®</div></div>
    <div class="text-option" data-id="Han6"><div class="name-en">Technology</div><div class="name-ko">Í∏∞Ïà†</div></div>
    <div class="text-option" data-id="Han7"><div class="name-en">Imagination</div><div class="name-ko">ÏÉÅÏÉÅÎ†•</div></div>
    <div class="text-option" data-id="Han8"><div class="name-en">Incomplete</div><div class="name-ko">ÎØ∏ÏôÑÏÑ±</div></div>
    <div class="text-option" data-id="Han9"><div class="name-en">Truth</div><div class="name-ko">ÏßÑÏã§</div></div>
    <div class="text-option" data-id="Han10"><div class="name-en">Thief</div><div class="name-ko">ÎèÑÎëë</div></div>
  </div>

  <!-- Ïù¥ÎØ∏ÏßÄ Ïä§Ìã∞Ïª§ Ï∂îÍ∞Ä -->
<img src="stickers/smile.png" class="sticker" draggable="true" />
<img src="stickers/question.png" class="sticker" draggable="true" />

  <button id="capture-btn">CAPTURE</button>
  <canvas id="canvas" style="display: none;"></canvas>

  <script>
const firebaseConfig = {
  apiKey: "AIzaSyCtN3FJJs73iGyRY9IqwKM5-oQCDeW0qZo",
  authDomain: "addabubble-aeeb7.firebaseapp.com",
  projectId: "addabubble-aeeb7",
  storageBucket: "addabubble-aeeb7.appspot.com",
  messagingSenderId: "56279476270",
  appId: "1:56279476270:web:7ece8c4916f8dc115f17bf"
};

firebase.initializeApp(firebaseConfig);
const storage = firebase.storage();
const db = firebase.firestore();
    
    const video = document.getElementById('camera-view');
    const captureBtn = document.getElementById('capture-btn');
    const canvas = document.getElementById('canvas');
    const body = document.body;

    // Ïπ¥Î©îÎùº Ïã§Ìñâ
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false })
      .then(stream => {
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          video.play();
        };
      })
      .catch(err => alert("Ïπ¥Î©îÎùºÏóê Ï†ëÍ∑ºÌï† Ïàò ÏóÜÏäµÎãàÎã§: " + err.message));

    // Í∏¥ Î¨∏Ïû• ÌÖçÏä§Ìä∏
const quotes = {
  Han1: {
    en: "If it can be expressed in one sentence,\nis it really art?",
    ko: "Ìïú Î¨∏Ïû•ÏúºÎ°ú ÌëúÌòÑÏù¥ Í∞ÄÎä•ÌïòÎã§Î©¥,\nÍ∑∏Í≤å ÏòàÏà†Ïù¥ ÎßûÎäîÍ∞Ä?"
  },
  Han2: {
    en: "If you think you can do it too,\nmaybe you should try.",
    ko: "ÎÇòÎèÑ Ìï† Ïàò ÏûàÏùÑ Í≤É Í∞ôÎã§Î©¥,\nÌïú Î≤à Ìï¥Î≥¥Îäî Í≤ÉÎèÑ Ï¢ãÏùÑÎìØ."
  },
  Han3: {
    en: "How many people truly equate\nart with life?",
    ko: "ÏòàÏà†Í≥º ÏÇ∂ÏùÑ ÎèôÏùºÏãú ÌïòÎäî ÏÇ¨ÎûåÏù¥\nÎ™áÏù¥ÎÇò ÎêòÍ≤†ÎäîÍ∞Ä."
  },
  Han4: {
    en: "If uniqueness defines art,\nthat idea is already outdated.",
    ko: "Ïú†ÏùºÌï®Ïù¥ ÏòàÏà†Ïùò ÌäπÏÑ±Ïù¥ÎûÄ ÎßêÏùÄ,\nÏòõ ÎßêÏùº ÎøêÏù¥Îã§."
  },
  Han5: {
    en: "Uncomfortable to see,\nimpossible to forget.",
    ko: "Î∂àÌé∏Ìï¥ÏÑú ÎààÏùÑ ÌîºÌñàÏßÄÎßå,\nÍ≥ÑÏÜç ÏÉùÍ∞ÅÎÇòÎçîÎùº."
  },
  Han6: {
    en: "The more technology evolves,\nthe more extraordinary the artist becomes.",
    ko: "Í∏∞Ïà†Ïù¥ Î∞úÏ†ÑÌï†ÏàòÎ°ù\nÏòàÏà†Í∞ÄÎäî Îçî ÎåÄÎã®Ìï¥ÏßÑÎã§."
  },
  Han7: {
    en: "Perfect order leaves\nno room for imagination.",
    ko: "ÏôÑÎ≤ΩÌïú ÏßàÏÑúÎäî\nÏÉÅÏÉÅÎ†•ÏùÑ ÌóàÏö©ÌïòÏßÄ ÏïäÎäîÎã§."
  },
  Han8: {
    en: "Without a viewer,\nit's incomplete.",
    ko: "Î≥¥Îäî Ïù¥Í∞Ä ÏóÜÏúºÎ©¥,\nÎØ∏ÏôÑÏÑ±Ïù¥Îã§."
  },
  Han9: {
    en: "If all you want is to speak the truth,\ngo to a news studio, not a gallery.",
    ko: "ÏßÑÏã§ÎßåÏùÑ ÎßêÌïòÎ†§Î©¥,\nÎØ∏Ïà†Í¥ÄÏù¥ ÏïÑÎãàÎùº Î∞©ÏÜ°Íµ≠ÏúºÎ°ú Í∞ÄÎùº."
  },
  Han10: {
    en: "Some works retrieve forgotten memories\nlike a thief.",
    ko: "Ïñ¥Îñ§ ÏûëÌíàÏùÄ ÏûäÍ≥† ÏûàÏóàÎçò Í∏∞ÏñµÏùÑ\nÎèÑÎëëÏ≤òÎüº Ï∞æÏïÑÎÇ∏Îã§."
  }
};

let lang = 'en'; // ‚úÖ Ï¥àÍ∏∞Í∞íÏùÄ ÏòÅÏñ¥
const langBtn = document.getElementById('lang-toggle');

langBtn.addEventListener('click', () => {
  lang = (lang === 'en') ? 'ko' : 'en';
  langBtn.textContent = 'Ìïú/EN';  // ‚úÖ Ìï≠ÏÉÅ Í≥†Ï†ïÎêú ÌëúÏãú
  if (currentTextSticker && currentTextSticker.dataset.id) {
    const id = currentTextSticker.dataset.id;
    const quote = quotes[id];
    currentTextSticker.textContent = quote[lang];
  }
});
    
let currentTextSticker = null;
let lastPosition = null;

document.querySelectorAll('.text-option').forEach(option => {
  option.addEventListener('click', () => {
    // ÏÑ†ÌÉù ÌëúÏãú
    document.querySelectorAll('.text-option').forEach(opt => opt.classList.remove('selected'));
    option.classList.add('selected');

    // Í∏∞Ï°¥ Ïä§Ìã∞Ïª§ Ï†úÍ±∞ Î∞è ÏúÑÏπò Ï†ÄÏû•
    if (currentTextSticker) {
      lastPosition = {
        left: currentTextSticker.style.left,
        top: currentTextSticker.style.top
      };
      currentTextSticker.remove();
    }

    const id = option.dataset.id;
    const quote = quotes[id];
    if (!quote) return;

const div = document.createElement('div');
div.className = 'text-sticker';
div.textContent = quote[lang];
div.dataset.id = id;
    
// Ïä§Ìã∞Ïª§Í∞Ä Ï≤òÏùå ÏÑ†ÌÉùÎê† Í≤ΩÏö∞ Ï§ëÏïô Ï†ïÎ†¨
if (lastPosition) {
  div.style.left = lastPosition.left;
  div.style.top = lastPosition.top;
} else {
  div.style.left = `${window.innerWidth / 2 - 100}px`;
  div.style.top = `${window.innerHeight / 2 - 30}px`;
}

makeDraggable(div);

// ‚úÖ ÎÑ§Ïò® Ìö®Í≥º Ï†ÅÏö©
const glow = neonColors[currentNeonIndex];
div.style.textShadow = `
  0 0 5px ${glow},
  0 0 10px ${glow},
  0 0 20px ${glow},
  0 0 40px ${glow}
`;

body.appendChild(div);
currentTextSticker = div;
  });
});

        const neonColors = ['#ffa500', '#00ffff', '#ff00ff', '#00ff00'];
        let currentNeonIndex = 0;

        let currentColorIndex = 0;
        const colorBtn = document.getElementById('color-toggle');

        colorBtn.addEventListener('click', () => {
        currentNeonIndex = (currentNeonIndex + 1) % neonColors.length;
        const glow = neonColors[currentNeonIndex];

        document.querySelectorAll('.text-sticker').forEach(el => {
        el.style.color = 'white';
        el.style.textShadow = `
        0 0 5px ${glow},
        0 0 10px ${glow},
        0 0 20px ${glow},
        0 0 40px ${glow}
    `;
  });
});
       
    function makeDraggable(div) {
      let offsetX, offsetY, isDragging = false;
      div.addEventListener('touchstart', e => {
        isDragging = true;
        const touch = e.touches[0];
        offsetX = touch.clientX - div.getBoundingClientRect().left;
        offsetY = touch.clientY - div.getBoundingClientRect().top;
      });
      document.addEventListener('touchmove', e => {
        if (!isDragging) return;
        const touch = e.touches[0];
        div.style.left = (touch.pageX - offsetX) + 'px';
        div.style.top = (touch.pageY - offsetY) + 'px';
      }, { passive: false });
      document.addEventListener('touchend', () => isDragging = false);
    }

    // Ï∫°Ï≤ò Í∏∞Îä•
   captureBtn.addEventListener('click', () => {
  const width = video.videoWidth;
  const height = video.videoHeight;

  if (width === 0 || height === 0) {
    alert("Ïπ¥Î©îÎùº ÏòÅÏÉÅÏù¥ ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.");
    return;
  }

  canvas.width = width;
  canvas.height = height;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, width, height);

// Ïä§Ìã∞Ïª§ Î†åÎçîÎßÅ
document.querySelectorAll('.sticker, .text-sticker').forEach(el => {
  const rect = el.getBoundingClientRect();
  const scaleX = width / window.innerWidth;
  const scaleY = height / window.innerHeight;
  const x = (rect.left + rect.width / 2) * scaleX;
  const y = rect.top * scaleY + 10;
  const lines = el.textContent.split('\n');

  // Î∞∞Í≤Ω
  ctx.fillStyle = window.getComputedStyle(el).backgroundColor;
  ctx.fillRect(rect.left * scaleX, rect.top * scaleY, rect.width * scaleX, rect.height * scaleY);

  // ÌÖçÏä§Ìä∏
const glowColor = window.getComputedStyle(el).color;
const shadow = window.getComputedStyle(el).textShadow;

// textShadowÍ∞Ä Ïó¨Îü¨ ÏÉâÏÉÅÏù¥ÎùºÎ©¥ Ï≤´ Î≤àÏß∏Îßå Ï∂îÏ∂ú
const match = shadow.match(/rgba?\([^)]+\)|#[0-9a-fA-F]+/);
const neonColor = match ? match[0] : glowColor;

ctx.font = '20px sans-serif';
ctx.fillStyle = 'white';              // Í∏∞Î≥∏ ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ
ctx.shadowColor = neonColor;          // ÎÑ§Ïò® ÏÉâÏÉÅ
ctx.shadowBlur = 15;                  // ÎÑ§Ïò® ÌôïÏÇ∞ Ìö®Í≥º
ctx.shadowOffsetX = 0;
ctx.shadowOffsetY = 0;
ctx.textAlign = 'center';
ctx.textBaseline = 'top';

lines.forEach((line, i) => {
  ctx.fillText(line, x, y + i * 24);
});
});

  // üì§ Í≥µÏú† ÎòêÎäî Îã§Ïö¥Î°úÎìú
canvas.toBlob(blob => {
  const preview = document.getElementById('preview-container');
  const img = document.getElementById('preview-img');
  const shareBtn = document.getElementById('share-btn');
  const downloadBtn = document.getElementById('download-btn');
  const retakeBtn = document.getElementById('retake-btn');

  const url = URL.createObjectURL(blob);
  img.src = url;
  preview.style.display = 'flex';

  const file = new File([blob], 'bubble-capture.png', { type: 'image/png' });

shareBtn.onclick = () => {
  const filename = `capture_${Date.now()}.png`;
  const storageRef = storage.ref().child('screenshots/' + filename);

  storageRef.put(file).then(snapshot => {
    snapshot.ref.getDownloadURL().then(url => {
      db.collection('screenshots').add({
        imageUrl: url,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        alert("ü´ß Bubble ArchiveÏóê ÏóÖÎ°úÎìú ÏôÑÎ£å!");
      }).catch(err => {
        alert("Firestore Ï†ÄÏû• Ïã§Ìå®: " + err.message);
      });
    });
  }).catch(err => {
    alert("Storage ÏóÖÎ°úÎìú Ïã§Ìå®: " + err.message);
  });
};

  downloadBtn.onclick = () => {
    const a = document.createElement('a');
    a.href = url;
    a.download = 'bubble-capture.png';
    a.click();
  };

  retakeBtn.onclick = () => {
    preview.style.display = 'none';
    URL.revokeObjectURL(url);
  };
}, 'image/png');
});
  </script>
  <div id="preview-container" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: black; z-index: 100; flex-direction: column; align-items: center; justify-content: center;">
  <img id="preview-img" style="max-width: 90%; max-height: 70%; margin-bottom: 20px;" />
  <div style="display: flex; gap: 10px;">
    <button id="share-btn" style="padding: 10px 16px; font-weight: bold;">SAVE</button>
    <button id="download-btn" style="padding: 10px 16px; font-weight: bold;">SHARE</button>
    <button id="retake-btn" style="padding: 10px 16px; font-weight: bold;">RESET</button>
  </div>
</div>
</body>
</html>
