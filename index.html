<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text Bubble Capture</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      overflow: hidden;
      font-family: sans-serif;
      background: black;
    }
    #camera-view {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: -1;
    }
    .text-carousel {
      position: absolute;
      bottom: 0;
      width: 100vw;
      height: 80px;
      display: flex;
      overflow-x: auto;
      background: rgba(0,0,0,0.4);
      padding: 6px;
      z-index: 10;
    }
    .text-option {
      background: white;
      color: black;
      border-radius: 12px;
      padding: 4px 10px;
      margin: 0 6px;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    .text-option.selected {
      background: #f0f0f0;
    }
    .name-en { font-weight: bold; }
    .name-ko { font-size: 12px; color: #555; }

    #bubble-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: transparent;
      padding: 0;
      border-radius: 0;
      color: white;
      font-size: 18px;
      font-weight: bold;
      max-width: 80vw;
      text-align: center;
      z-index: 5;
      pointer-events: auto;
      cursor: grab;
      user-select: none;
      display: none;
      word-break: break-word;
    }

    .quote-en, .quote-ko { margin: 4px 0; }

    #toggle-lang, #capture, #share, #style-toggle, #reset {
      position: absolute;
      z-index: 10;
      background: white;
      border: none;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    #toggle-lang { bottom: 120px; left: 20px; font-weight: bold; }
    #capture {
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      font-size: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #style-toggle { bottom: 120px; right: 20px; }
    #share { bottom: 200px; left: 20px; }
    #reset { top: 20px; right: 20px; }
    #share:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .bubble-style-neon-green {
      text-shadow:
        0 0 5px #00ff90,
        0 0 10px #00ff90,
        0 0 20px #00ff90,
        0 0 40px #00ff90;
    }
    .bubble-style-neon-orange {
      text-shadow:
        0 0 5px #ffaa00,
        0 0 10px #ffaa00,
        0 0 20px #ffaa00,
        0 0 40px #ffaa00;
    }
    .bubble-style-neon-blue {
      text-shadow:
        0 0 5px #00ccff,
        0 0 10px #00ccff,
        0 0 20px #00ccff,
        0 0 40px #00ccff;
    }

    /* ÌåùÏóÖ Ïä§ÌÉÄÏùº */
    #popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #popup .popup-content {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    #popup button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

    <video id="camera-view" autoplay playsinline muted></video>

  <div class="text-carousel">
    <div class="text-option" data-id="Han1"><div class="name-en">one sentence</div><div class="name-ko">Ìïú Î¨∏Ïû•</div></div>
    <div class="text-option" data-id="Han2"><div class="name-en">try</div><div class="name-ko">ÏãúÎèÑ</div></div>
    <div class="text-option" data-id="Han3"><div class="name-en">life</div><div class="name-ko">ÏÇ∂</div></div>
    <div class="text-option" data-id="Han4"><div class="name-en">unique</div><div class="name-ko">Ïú†ÏùºÌï®</div></div>
    <div class="text-option" data-id="Han5"><div class="name-en">uncomfortable</div><div class="name-ko">Î∂àÌé∏Ìï®</div></div>
    <div class="text-option" data-id="Han6"><div class="name-en">technology</div><div class="name-ko">Í∏∞Ïà†</div></div>
    <div class="text-option" data-id="Han7"><div class="name-en">Perfect</div><div class="name-ko">ÏôÑÎ≤Ω</div></div>
    <div class="text-option" data-id="Han8"><div class="name-en">incomplete</div><div class="name-ko">ÎØ∏ÏôÑÏÑ±</div></div>
    <div class="text-option" data-id="Han9"><div class="name-en">truth</div><div class="name-ko">ÏßÑÏã§</div></div>
    <div class="text-option" data-id="Han10"><div class="name-en">thief</div><div class="name-ko">ÎèÑÎëë</div></div>
  </div>

  <div id="bubble-text">
    <div class="quote-en"></div>
    <div class="quote-ko"></div>
  </div>

  <button id="toggle-lang">KO / EN</button>
  <button id="capture">üì∏</button>
  <button id="style-toggle">Style</button>
  <button id="share" disabled>Share</button>
  <button id="reset">‚Üª Reset</button>

  <!-- ÌåùÏóÖ UI -->
  <div id="popup">
    <div class="popup-content">
      <p>Choose an action:</p>
      <button onclick="saveOnly()">Save Only</button>
      <button onclick="shareOnly()">Share Only</button>
      <button onclick="saveAndShare()">Save & Share</button>
    </div>
  </div>
  
  <script>
    const video = document.getElementById('camera-view');
    const bubble = document.getElementById('bubble-text');
    const quoteEn = document.querySelector('.quote-en');
    const quoteKo = document.querySelector('.quote-ko');

    const quotes = {
      Han1: {
        en: "If it can be expressed in one sentence, is it really art?",
        ko: "Ìïú Î¨∏Ïû•ÏúºÎ°ú ÌëúÌòÑÏù¥ Í∞ÄÎä•ÌïòÎã§Î©¥, Í∑∏Í≤å ÏòàÏà†Ïù¥ ÎßûÎäîÍ∞Ä?"
      },
      Han2: {
        en: "If you think you can do it too, maybe you should try.",
        ko: "ÎÇòÎèÑ Ìï† Ïàò ÏûàÏùÑ Í≤É Í∞ôÎã§Î©¥, Ìïú Î≤à Ìï¥Î≥¥Îäî Í≤ÉÎèÑ Ï¢ãÏùÑÎìØ."
      },
      Han3: {
        en: "How many people truly equate art with life?",
        ko: "ÏòàÏà†Í≥º ÏÇ∂ÏùÑ ÎèôÏùºÏãú ÌïòÎäî ÏÇ¨ÎûåÏù¥ Î™áÏù¥ÎÇò ÎêòÍ≤†ÎäîÍ∞Ä."
      },
      Han4: {
        en: "If uniqueness defines art, that idea is already outdated.",
        ko: "Ïú†ÏùºÌï®Ïù¥ ÏòàÏà†Ïùò ÌäπÏÑ±Ïù¥ÎûÄ ÎßêÏùÄ, Ïòõ ÎßêÏùº ÎøêÏù¥Îã§."
      },
      Han5: {
        en: "Uncomfortable to see, impossible to forget.",
        ko: "Î∂àÌé∏Ìï¥ÏÑú ÎààÏùÑ ÌîºÌñàÏßÄÎßå, Í≥ÑÏÜç ÏÉùÍ∞ÅÎÇòÎçîÎùº."
      },
      Han6: {
        en: "The more technology evolves, the more extraordinary the artist becomes.",
        ko: "Í∏∞Ïà†Ïù¥ Î∞úÏ†ÑÌï†ÏàòÎ°ù ÏòàÏà†Í∞ÄÎäî Îçî ÎåÄÎã®Ìï¥ÏßÑÎã§."
      },
      Han7: {
        en: "Perfect order leaves no room for imagination.",
        ko: "ÏôÑÎ≤ΩÌïú ÏßàÏÑúÎäî ÏÉÅÏÉÅÎ†•ÏùÑ ÌóàÏö©ÌïòÏßÄ ÏïäÎäîÎã§."
      },
      Han8: {
        en: "Without a viewer, it's incomplete.",
        ko: "Î≥¥Îäî Ïù¥Í∞Ä ÏóÜÏúºÎ©¥, ÎØ∏ÏôÑÏÑ±Ïù¥Îã§."
      },
      Han9: {
        en: "If all you want is to speak the truth, go to a news studio, not a gallery.",
        ko: "ÏßÑÏã§ÎßåÏùÑ ÎßêÌïòÎ†§Î©¥, ÎØ∏Ïà†Í¥ÄÏù¥ ÏïÑÎãàÎùº Î∞©ÏÜ°Íµ≠ÏúºÎ°ú Í∞ÄÎùº."
      },
      Han10: {
        en: "Some works retrieve forgotten memories like a thief.",
        ko: "Ïñ¥Îñ§ ÏûëÌíàÏùÄ ÏûäÍ≥† ÏûàÏóàÎçò Í∏∞ÏñµÏùÑ ÎèÑÎëëÏ≤òÎüº Ï∞æÏïÑÎÇ∏Îã§."
      }
    };

    let currentLang = 'en';

    function updateQuote(id, optionEl) {
      const quote = quotes[id];
      if (!quote) return;
      quoteEn.textContent = quote.en;
      quoteKo.textContent = quote.ko;
      bubble.style.display = 'block';
      bubble.style.left = '50%';
      bubble.style.top = '50%';
      bubble.style.transform = 'translate(-50%, -50%)';
      updateLangVisibility();
      document.querySelectorAll('.text-option').forEach(el => el.classList.remove('selected'));
      optionEl.classList.add('selected');
    }

    function updateLangVisibility() {
      quoteEn.style.display = (currentLang === 'en') ? 'block' : 'none';
      quoteKo.style.display = (currentLang === 'ko') ? 'block' : 'none';
    }

    document.querySelectorAll('.text-option').forEach(option => {
      option.addEventListener('click', () => updateQuote(option.dataset.id, option));
    });

    document.getElementById('toggle-lang').addEventListener('click', () => {
      currentLang = (currentLang === 'en') ? 'ko' : 'en';
      updateLangVisibility();
    });

    const neonClasses = [
      'bubble-style-neon-green',
      'bubble-style-neon-orange',
      'bubble-style-neon-blue'
    ];
    let currentNeonIndex = 0;
    bubble.classList.add(neonClasses[0]);

    document.getElementById('style-toggle').addEventListener('click', () => {
      bubble.classList.remove(neonClasses[currentNeonIndex]);
      currentNeonIndex = (currentNeonIndex + 1) % neonClasses.length;
      bubble.classList.add(neonClasses[currentNeonIndex]);
    });

    document.getElementById('reset').addEventListener('click', resetUI);

    function resetUI() {
      bubble.style.display = 'none';
      document.querySelectorAll('.text-option').forEach(el => el.classList.remove('selected'));
      document.getElementById('share').disabled = true;

      // Reset neon
      bubble.classList.remove(...neonClasses);
      currentNeonIndex = 0;
      bubble.classList.add(neonClasses[0]);

      quoteEn.textContent = '';
      quoteKo.textContent = '';
    }

    // ÎìúÎûòÍ∑∏ Í∏∞Îä•
    let isDragging = false, offsetX, offsetY;
    bubble.addEventListener('mousedown', startDrag);
    bubble.addEventListener('touchstart', startDrag, { passive: false });

    function startDrag(e) {
      isDragging = true;
      const rect = bubble.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      offsetX = clientX - rect.left;
      offsetY = clientY - rect.top;
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);
      document.addEventListener('touchmove', onDrag, { passive: false });
      document.addEventListener('touchend', stopDrag);
    }

    function onDrag(e) {
      if (!isDragging) return;
      e.preventDefault();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      const bubbleWidth = bubble.offsetWidth;
      const bubbleHeight = bubble.offsetHeight;
      const maxX = window.innerWidth - bubbleWidth;
      const maxY = window.innerHeight - bubbleHeight;
      let x = clientX - offsetX;
      let y = clientY - offsetY;
      x = Math.max(0, Math.min(x, maxX));
      y = Math.max(0, Math.min(y, maxY));
      bubble.style.left = `${x}px`;
      bubble.style.top = `${y}px`;
      bubble.style.transform = `translate(0, 0)`;
    }

    function stopDrag() {
      isDragging = false;
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', stopDrag);
      document.removeEventListener('touchmove', onDrag);
      document.removeEventListener('touchend', stopDrag);
    }

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => video.srcObject = stream);

        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      for (let i = 0; i < words.length; i++) {
        const testLine = line + words[i] + ' ';
        const testWidth = ctx.measureText(testLine).width;
        if (testWidth > maxWidth && i > 0) {
          ctx.strokeText(line, x, y);
          ctx.fillText(line, x, y);
          line = words[i] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.strokeText(line, x, y);
      ctx.fillText(line, x, y);
    }

    let lastCaptureBlob = null;

    document.getElementById('share').addEventListener('click', async () => {
      if (!lastCaptureBlob) return;
      const canvas = document.createElement('canvas');
      const width = video.videoWidth;
      const height = video.videoHeight;
      if (!width || !height) {
        alert("Ïπ¥Î©îÎùº Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.");
        return;
      }

      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, width, height);

      const bubbleRect = bubble.getBoundingClientRect();
      const videoRect = video.getBoundingClientRect();
      const scaleX = width / videoRect.width;
      const scaleY = height / videoRect.height;
      const x = (bubbleRect.left - videoRect.left) * scaleX;
      const y = (bubbleRect.top - videoRect.top) * scaleY;
      const bubbleW = bubbleRect.width * scaleX;
      const bubbleH = bubbleRect.height * scaleY;

      ctx.font = `${18 * scaleY}px sans-serif`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      const text = (currentLang === 'en') ? quoteEn.textContent : quoteKo.textContent;
      const neonColors = ["#00ff90", "#ffaa00", "#00ccff"];
      ctx.lineWidth = 4;
      ctx.strokeStyle = neonColors[currentNeonIndex];
      ctx.fillStyle = "white";

      wrapText(ctx, text, x + bubbleW / 2, y + bubbleH / 2 - 10, bubbleW - 20, 24 * scaleY);

      canvas.toBlob((blob) => {
        if (!blob) return;
        lastCaptureBlob = blob;

        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'text-bubble-capture.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        document.getElementById('share').disabled = false;
      }, 'image/png');
    });

    document.getElementById('share').addEventListener('click', async () => {
      if (!lastCaptureBlob) return;

      const filesArray = [new File([lastCaptureBlob], 'art-quote.png', { type: 'image/png' })];

      const shareData = {
        title: 'Art Quote',
        text: 'Here‚Äôs an art quote I captured.',
        files: filesArray
      };

      try {
        if (navigator.canShare && navigator.canShare({ files: filesArray })) {
          await navigator.share(shareData);
          alert('Í≥µÏú† ÏôÑÎ£å!');
        } else {
          alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî Ïù¥ÎØ∏ÏßÄ Í≥µÏú†Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
        }
      } catch (err) {
        console.error('Í≥µÏú† Ïã§Ìå®:', err);
      }

      // Í≥µÏú† ÏôÑÎ£å ÌõÑ UI Ï¥àÍ∏∞Ìôî
      resetUI();

          function showPopup() {
      document.getElementById("popup").style.display = "flex";
    }

    function hidePopup() {
      document.getElementById("popup").style.display = "none";
    }

    function saveOnly() {
      if (!lastCaptureBlob) return;
      const url = URL.createObjectURL(lastCaptureBlob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "bubble.png";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      hidePopup();
      resetUI();
    }

    function shareOnly() {
      if (!lastCaptureBlob) return;
      // Ïó¨Í∏∞Ïóê Í≥µÏú† Î≥¥Í¥ÄÌï® ÏóÖÎ°úÎìú Î°úÏßÅ ÏÇΩÏûÖ ÏòàÏ†ï
      alert("Shared to public folder (demo)");
      hidePopup();
      resetUI();
    }

    function saveAndShare() {
      saveOnly();
      shareOnly();
    }

    // Ï∫°Ï≤ò Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú showPopup Ìò∏Ï∂úÌïòÎèÑÎ°ù ÏàòÏ†ï
    document.getElementById("capture").addEventListener("click", () => {
      // Í∏∞Ï°¥ Ï∫°Ï≤ò Î°úÏßÅ ...
      showPopup();
    });
      
    });
  </script>
</body>
</html>
