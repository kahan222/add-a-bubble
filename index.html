<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Add a Bubble</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      background: black;
    }
    #camera-view {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 0;
    }
    .sticker {
      position: absolute;
      font-size: 24px;
      background: white;
      color: black;
      padding: 4px 10px;
      border-radius: 12px;
      cursor: move;
      white-space: pre-line;
    }
    .text-sticker {
      position: absolute;
      font-size: 16px;
      background: white;
      color: black;
      padding: 4px 10px;
      border-radius: 12px;
      cursor: move;
      white-space: pre-line;
    }
    .sticker-bar, .text-carousel {
      position: absolute;
      width: 100%;
      display: flex;
      overflow-x: auto;
      background: rgba(0,0,0,0.5);
      padding: 6px;
      z-index: 10;
    }
    .sticker-bar {
      bottom: 0;
    }
    .text-carousel {
      bottom: 20px;
    }
    .sticker-option, .text-option {
      background: white;
      color: black;
      padding: 6px 12px;
      border-radius: 20px;
      margin-right: 10px;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      flex-shrink: 0;
    }

     .text-option.selected {
      outline: 3px solid yellow;
      background: #ffffcc;
    }
    .name-en {
      font-weight: bold;
    }
    .name-ko {
      font-size: 12px;
    }
    #capture-btn {
      position: absolute;
      bottom: 150px;
      right: 20px;
      padding: 10px 18px;
      background: white;
      color: black;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      z-index: 11;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <video id="camera-view" autoplay playsinline muted></video>

<button id="lang-toggle" style="
  position: absolute;
  bottom: 110px;    
  left: 20px;    
  z-index: 12;
  background: white;
  color: black;
  border: none;
  padding: 8px 14px;
  border-radius: 10px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
">[KO/EN]</button>
  
  <div class="text-carousel" id="text-carousel">
    <div class="text-option" data-id="Han1"><div class="name-en">One Sentence</div><div class="name-ko">í•œ ë¬¸ì¥</div></div>
    <div class="text-option" data-id="Han2"><div class="name-en">Try</div><div class="name-ko">ì‹œë„</div></div>
    <div class="text-option" data-id="Han3"><div class="name-en">Life</div><div class="name-ko">ì‚¶</div></div>
    <div class="text-option" data-id="Han4"><div class="name-en">Uniqueness</div><div class="name-ko">ìœ ì¼í•¨</div></div>
    <div class="text-option" data-id="Han5"><div class="name-en">Uncomfortable</div><div class="name-ko">ë¶ˆí¸í•¨</div></div>
    <div class="text-option" data-id="Han6"><div class="name-en">Technology</div><div class="name-ko">ê¸°ìˆ </div></div>
    <div class="text-option" data-id="Han7"><div class="name-en">Imagination</div><div class="name-ko">ìƒìƒë ¥</div></div>
    <div class="text-option" data-id="Han8"><div class="name-en">Incomplete</div><div class="name-ko">ë¯¸ì™„ì„±</div></div>
    <div class="text-option" data-id="Han9"><div class="name-en">Truth</div><div class="name-ko">ì§„ì‹¤</div></div>
    <div class="text-option" data-id="Han10"><div class="name-en">Thief</div><div class="name-ko">ë„ë‘‘</div></div>
  </div>

  <button id="capture-btn">ğŸ“¸ Capture</button>
  <canvas id="canvas" style="display: none;"></canvas>

  <script>
    const video = document.getElementById('camera-view');
    const captureBtn = document.getElementById('capture-btn');
    const canvas = document.getElementById('canvas');
    const body = document.body;

    // ì¹´ë©”ë¼ ì‹¤í–‰
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false })
      .then(stream => {
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          video.play();
        };
      })
      .catch(err => alert("ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + err.message));

    // ê¸´ ë¬¸ì¥ í…ìŠ¤íŠ¸
    const quotes = {
      Han1: { en: "If it can be expressed in one sentence, is it really art?", ko: "í•œ ë¬¸ì¥ìœ¼ë¡œ í‘œí˜„ì´ ê°€ëŠ¥í•˜ë‹¤ë©´, ê·¸ê²Œ ì˜ˆìˆ ì´ ë§ëŠ”ê°€?" },
      Han2: { en: "If you think you can do it too, maybe you should try.", ko: "ë‚˜ë„ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤ë©´, í•œ ë²ˆ í•´ë³´ëŠ” ê²ƒë„ ì¢‹ì„ë“¯." },
      Han3: { en: "How many people truly equate art with life?", ko: "ì˜ˆìˆ ê³¼ ì‚¶ì„ ë™ì¼ì‹œ í•˜ëŠ” ì‚¬ëŒì´ ëª‡ì´ë‚˜ ë˜ê² ëŠ”ê°€." },
      Han4: { en: "If uniqueness defines art, that idea is already outdated.", ko: "ìœ ì¼í•¨ì´ ì˜ˆìˆ ì˜ íŠ¹ì„±ì´ë€ ë§ì€, ì˜› ë§ì¼ ë¿ì´ë‹¤." },
      Han5: { en: "Uncomfortable to see, impossible to forget.", ko: "ë¶ˆí¸í•´ì„œ ëˆˆì„ í”¼í–ˆì§€ë§Œ, ê³„ì† ìƒê°ë‚˜ë”ë¼." },
      Han6: { en: "The more technology evolves, the more extraordinary the artist becomes.", ko: "ê¸°ìˆ ì´ ë°œì „í• ìˆ˜ë¡ ì˜ˆìˆ ê°€ëŠ” ë” ëŒ€ë‹¨í•´ì§„ë‹¤." },
      Han7: { en: "Perfect order leaves no room for imagination.", ko: "ì™„ë²½í•œ ì§ˆì„œëŠ” ìƒìƒë ¥ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤." },
      Han8: { en: "Without a viewer, it's incomplete.", ko: "ë³´ëŠ” ì´ê°€ ì—†ìœ¼ë©´, ë¯¸ì™„ì„±ì´ë‹¤." },
      Han9: { en: "If all you want is to speak the truth, go to a news studio, not a gallery.", ko: "ì§„ì‹¤ë§Œì„ ë§í•˜ë ¤ë©´, ë¯¸ìˆ ê´€ì´ ì•„ë‹ˆë¼ ë°©ì†¡êµ­ìœ¼ë¡œ ê°€ë¼." },
      Han10: { en: "Some works retrieve forgotten memories like a thief.", ko: "ì–´ë–¤ ì‘í’ˆì€ ìŠê³  ìˆì—ˆë˜ ê¸°ì–µì„ ë„ë‘‘ì²˜ëŸ¼ ì°¾ì•„ë‚¸ë‹¤." }
    };

let lang = 'en'; // âœ… ì´ˆê¸°ê°’ì€ ì˜ì–´
const langBtn = document.getElementById('lang-toggle');

langBtn.addEventListener('click', () => {
  lang = (lang === 'en') ? 'ko' : 'en';
  langBtn.textContent = (lang === 'en') ? 'KO' : 'EN';

  // ê¸°ì¡´ ìŠ¤í‹°ì»¤ í…ìŠ¤íŠ¸ë„ ì—…ë°ì´íŠ¸
  if (currentTextSticker && currentTextSticker.dataset.id) {
    const id = currentTextSticker.dataset.id;
    const quote = quotes[id];
    currentTextSticker.textContent = quote[lang];
  }
});
    
    let currentTextSticker = null;
    document.querySelectorAll('.text-option').forEach(option => {
      option.addEventListener('click', () => {
        const id = option.dataset.id;
        const quote = quotes[id];
        if (!quote) return;
        if (currentTextSticker) currentTextSticker.remove();
        const div = document.createElement('div');
        div.className = 'text-sticker';
        div.textContent = quote[lang]; 
        div.dataset.id = id;  
        div.dataset.id = id;
        div.style.left = '30px';
        div.style.top = '30px';
        makeDraggable(div);
        body.appendChild(div);
        currentTextSticker = div;
      });
    });

    function makeDraggable(div) {
      let offsetX, offsetY, isDragging = false;
      div.addEventListener('touchstart', e => {
        isDragging = true;
        const touch = e.touches[0];
        offsetX = touch.clientX - div.getBoundingClientRect().left;
        offsetY = touch.clientY - div.getBoundingClientRect().top;
      });
      document.addEventListener('touchmove', e => {
        if (!isDragging) return;
        const touch = e.touches[0];
        div.style.left = (touch.pageX - offsetX) + 'px';
        div.style.top = (touch.pageY - offsetY) + 'px';
      }, { passive: false });
      document.addEventListener('touchend', () => isDragging = false);
    }

    // ìº¡ì²˜ ê¸°ëŠ¥
   captureBtn.addEventListener('click', () => {
  const width = video.videoWidth;
  const height = video.videoHeight;

  if (width === 0 || height === 0) {
    alert("ì¹´ë©”ë¼ ì˜ìƒì´ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    return;
  }

  canvas.width = width;
  canvas.height = height;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, width, height);

  // ìŠ¤í‹°ì»¤ ë Œë”ë§
  document.querySelectorAll('.sticker, .text-sticker').forEach(el => {
    const rect = el.getBoundingClientRect();
    const scaleX = width / window.innerWidth;
    const scaleY = height / window.innerHeight;
    ctx.font = '24px sans-serif';
    ctx.fillStyle = 'white';
    ctx.fillRect(rect.left * scaleX, rect.top * scaleY, rect.width * scaleX, rect.height * scaleY);
    ctx.fillStyle = 'black';
    const lines = el.textContent.split('\n');
    lines.forEach((line, i) => {
      ctx.fillText(line, rect.left * scaleX + 10, rect.top * scaleY + 30 + i * 30);
    });
  });

  // ğŸ“¤ ê³µìœ  ë˜ëŠ” ë‹¤ìš´ë¡œë“œ
  canvas.toBlob(blob => {
    const file = new File([blob], 'bubble-capture.png', { type: 'image/png' });

    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      navigator.share({
        files: [file],
        title: 'Add a Bubble',
        text: 'Check out my AR bubble image!',
      }).catch(err => {
        console.warn('ê³µìœ  ì·¨ì†Œë¨ ë˜ëŠ” ì‹¤íŒ¨:', err);
      });
    } else {
      // fallback ë‹¤ìš´ë¡œë“œ
      const link = document.createElement('a');
      link.download = 'bubble-capture.png';
      link.href = URL.createObjectURL(blob);
      link.click();
    }
  }, 'image/png');
});
  </script>
</body>
</html>
